# Chanakya Paint – Project Q&A Cheat Sheet

Use this as a quick reference to answer common questions about the app, its architecture, workflows, deployment, and operations.

## Elevator Pitch

- A fast, offline‑capable drawing and PDF annotation app optimized for Raspberry Pi 5.
- Runs as a web/PWA or native Electron desktop app, sharing the same React UI.

## Core Capabilities

- Paint tools: pencil, eraser, shapes, highlighter, colors, brush size, undo/redo.
- PDF: upload, multi‑page viewing, text selection highlights, drawing overlays, save edited PDF.
- Offline support: local PDF.js worker, PWA caching.
- Simple navigation between Paint and PDF modes.

## Architecture Overview

- React + Vite app: [src/App.jsx](src/App.jsx), [src/main.jsx](src/main.jsx).
- Routing: `/` → Paint, `/pdf` → PDF. Floating nav in [src/components/Navigation.jsx](src/components/Navigation.jsx).
- PDF module: [src/components/pdf/PDFMerged.jsx](src/components/pdf/PDFMerged.jsx) (viewer + editor unified).
- Paint module: [src/components/paint](src/components/paint) (toolbar, palette, canvas, galleries).
- Services: [src/services/electronService.js](src/services/electronService.js), [src/services/storageService.js](src/services/storageService.js).
- UI kit: [src/components/ui](src/components/ui) (shadcn/Radix components).
- Electron (optional): [electron.js](electron.js), [electron-preload.js](electron-preload.js).
- Offline PDF worker: [public/pdf.worker.min.mjs](public/pdf.worker.min.mjs).
- Docs: conversion, deployment, guides in project root.

## Runtime Workflow (Web vs Electron)

- App bootstrap: Vite mounts React root; providers for tooltips, toasts, React Query in [src/App.jsx](src/App.jsx).
- Routing: React Router handles `/` and `/pdf`. Nav buttons switch modes.
- Web path: Uses browser file APIs; PDF save falls back to download.
- Electron path: Renderer calls APIs via preload bridge; native dialogs and filesystem saves.

## PDF Subsystem (Unified)

- Rendering: `react-pdf` (`Document`, `Page`) powered by local PDF.js worker at [public/pdf.worker.min.mjs](public/pdf.worker.min.mjs).
- Text layer: Imports official CSS to ensure correct selectable text positioning; custom z‑index keeps text above page canvas.
- Highlighting: Selection from the text layer; normalize coordinates per page & scale; overlays rendered per page; drawing disabled during highlight mode.
- Drawing: Per‑page canvas overlays capture pencil/eraser/shapes/text; points stored normalized to current zoom.
- Multi‑page scroll: Renders all pages; per‑page refs enable next/prev navigation and scrolling to highlights.
- Saving: `pdf-lib` embeds canvas annotations into the PDF; simple rectangles for highlights; Electron dialog or browser download fallback.

## Paint Subsystem

- Tools & UI: Toolbar, palette, sliders in [src/components/paint](src/components/paint); canvas rendering and history management.
- Gallery: Local saved pages; cloud gallery stubs ready for integration.

## Offline & PWA

- PWA: Service worker & manifest generated by Vite; `npm run build` produces [dist](dist) with offline caching.
- PDF worker: Local file ensures PDF rendering without network.
- Behavior: App functions offline for drawing and PDF annotation after first install/build.

## Storage & Services

- Electron bridge: [electron-preload.js](electron-preload.js) exposes safe APIs; [electron.js](electron.js) implements native dialogs & filesystem.
- Renderer API: [src/services/electronService.js](src/services/electronService.js) abstracts native vs web behaviors.
- Local storage: [src/services/storageService.js](src/services/storageService.js) for gallery/records (IndexedDB/local strategies).
- Cloud: Supabase scaffolding under [src/integrations/supabase](src/integrations/supabase) (optional).

## Build & Deploy

- Web/PWA:
  ```bash
  npm install
  npm run build
  npm run preview
  ```
- Electron (desktop):
  ```bash
  npm run electron:dev   # dev with hot reload
  npm run electron       # run production build
  npm run electron:build # package installers
  ```
- Raspberry Pi 5:
  - Automated:
    ```bash
    cd ~ && git clone https://github.com/raghuwanshi313/EDP_APP.git && \
    cd EDP_APP && chmod +x *.sh && ./setup-electron-pi.sh
    ```
  - Pi builds:
    ```bash
    npm run electron:build:pi64  # Pi 5 (ARM64)
    npm run electron:build:pi    # Pi 4/older (ARMv7)
    ```

## Common User Flows

- Open & annotate PDF:
  1. Go to `/pdf`, upload a PDF.
  2. Scroll pages; use highlight or drawing tools.
  3. Save: Electron dialog or browser download.
- Draw on canvas:
  1. Go to `/`, pick tool, color, size.
  2. Draw, undo/redo, save to gallery.
- Offline use:
  1. Build PWA; app works without internet.
  2. PDF rendering uses local worker.

## Security & Privacy

- Preload bridge restricts renderer APIs; no direct filesystem access.
- Offline by default; no external calls for PDF rendering.

## Performance

- PDF multi‑page with overlays can be heavy; bundle warnings are normal.
- Raspberry Pi guides include GPU tuning & zram swap for stability.

## Repository & Versioning

- Remote: `origin` → https://github.com/raghuwanshi313/EDP_RESPARRY-PI
- Branch: `main`; use feature/cleanup branches for safe changes.
- Typical flow:
  ```bash
  git add -A
  git commit -m "<message>"
  git push
  ```

## Troubleshooting (Quick)

- PDF text not selectable → Ensure TextLayer CSS is imported in the PDF component.
- Highlights misaligned → Confirm normalization by page rect and current scale.
- Save fails in web → Use browser download fallback; check file permissions.
- Electron errors → Verify preload bridge and IPC channels; run `npm run electron:dev`.

## FAQs

- Does it work offline? — Yes, PWA caches assets; PDF uses local worker.
- Can it run without Electron? — Yes, as a web app via `npm run preview`.
- How are highlights saved? — Rectangles rendered into the PDF via `pdf-lib`.
- Where’s the PDF worker? — [public/pdf.worker.min.mjs](public/pdf.worker.min.mjs).
- How to deploy to Pi 5? — Use the automated `setup-electron-pi.sh` or build ARM64 packages.
